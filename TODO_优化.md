# 一致性检查系统 - 待优化事项

## 🎯 当前问题

### 1. 修改建议生成逻辑

**现状**：
- ✅ 已修改：现在总是为找到的相关文档生成修改建议
- 之前：如果AI认为不需要全局一致性(`global_consistency_required: false`)，就不生成修改

**优化方向**：
- 考虑添加"强制生成"选项，让用户选择是否听从AI建议

### 2. 文档显示优化

**当前显示**：
- ✅ RAG检索到的相关文档列表（卡片式）
- ✅ AI生成的修改建议列表
- ✅ Monaco Diff Editor 对比

**可以改进**：
- [ ] 在相关文档卡片上添加"预览"按钮，直接查看原文
- [ ] 显示每个文档的相关度得分
- [ ] 支持手动选择哪些文档需要生成修改

### 3. 用户体验改进

**建议**：
1. **文档预览功能**
   ```jsx
   <button onClick={() => handlePreviewDoc(filePath)}>
     预览原文
   </button>
   ```
   点击后弹出Monaco Editor只读模式

2. **批量操作**
   - [ ] 批量应用修改
   - [ ] 批量下载修改后的文档
   - [ ] 修改历史记录

3. **更智能的提示**
   - 如果找到0个文档：提示调整关键词或增大Top-K
   - 如果找到文档但不生成修改：显示AI的分析原因

### 4. 性能优化

**当前瓶颈**：
- 从MinIO读取大文档可能较慢
- AI生成多个修改建议是串行的

**优化方案**：
- [ ] 并行读取多个文档
- [ ] 并行生成修改建议（注意LLM API限流）
- [ ] 添加进度条显示

### 5. 错误处理增强

**需要处理的场景**：
- [ ] MinIO URL访问失败（404、超时）
- [ ] 文档内容为空
- [ ] AI生成失败（API错误、超时）
- [ ] 文档格式不支持（非Markdown）

## 📝 下一步计划

### 短期（本周）
1. ✅ 修复metadata提取问题
2. ✅ 总是生成修改建议
3. [ ] 添加文档预览功能
4. [ ] 改进错误提示

### 中期（本月）
1. [ ] 批量操作功能
2. [ ] 并行优化
3. [ ] 修改历史记录

### 长期
1. [ ] 支持更多文件格式（PDF、DOCX）
2. [ ] 智能合并冲突
3. [ ] 自动化测试

## 💡 创新想法

### 1. 智能建议模式
- AI不仅判断是否需要修改，还给出修改优先级
- 用户可以按优先级批量处理

### 2. 协作审核
- 多人协作审核修改建议
- 投票决定是否应用某个修改

### 3. 版本控制集成
- 与Git集成
- 自动创建分支并提交修改

## 🐛 已知Bug

无

## ✅ 已完成

- [x] RAG数据结构兼容性问题
- [x] metadata字段名识别（file_path, source_identifier等）
- [x] 修改建议生成逻辑优化
- [x] 前端UI优化（相关文档展示）

